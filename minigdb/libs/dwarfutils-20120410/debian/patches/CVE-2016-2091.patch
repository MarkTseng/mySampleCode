Description: Fix for CVE-2016-2091
 The dwarf_read_cie_fde_prefix function in dwarf_frame2.c in libdwarf
 allows attackers to cause a denial of service (out-of-bounds read)
 via a crafted ELF object file.
Origin: https://sourceforge.net/p/libdwarf/code/ci/9565964f26966d8391fe2cfa8e6e8e59278c5f91
Bug-Debian: https://bugs.debian.org/813148

--- a/libdwarf/dwarf_frame2.c
+++ b/libdwarf/dwarf_frame2.c
@@ -939,7 +939,12 @@
     Dwarf_Small *frame_ptr = frame_ptr_in;
     Dwarf_Small *cie_ptr_addr = 0;
     Dwarf_Unsigned cie_id = 0;
+    Dwarf_Small *section_end = section_ptr_in + section_length_in;
 
+    if (section_end < (frame_ptr + 4)) {
+        _dwarf_error (dbg, error, DW_DLE_DEBUG_FRAME_LENGTH_BAD);
+        return DW_DLV_ERROR;
+    }
     /* READ_AREA_LENGTH updates frame_ptr for consumed bytes */
     READ_AREA_LENGTH(dbg, length, Dwarf_Unsigned,
         frame_ptr, local_length_size,
@@ -951,6 +956,10 @@
             data. We should be very close to end of section. */
         return DW_DLV_NO_ENTRY;
     }
+    if ((frame_ptr + local_length_size) >= section_end) {
+        _dwarf_error (dbg, error, DW_DLE_DEBUG_FRAME_LENGTH_BAD);
+        return DW_DLV_ERROR;
+    }
 
     cie_ptr_addr = frame_ptr;
     READ_UNALIGNED(dbg, cie_id, Dwarf_Unsigned,
